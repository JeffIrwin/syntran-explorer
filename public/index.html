
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">Syntran explorer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div style="display: table; margin: auto;">
        <h1 id="heading1">Syntran explorer</h1>
        <h3>Help: <a href="https://github.com/JeffIrwin/syntran">documentation</a> </h3>

	<label for="sample" style="display: inline-block;">Choose a sample: &nbsp;</label>
        <select name="sample" id="sample" onChange="javascript:submitSampleSelect();">
            <option value="hello">hello world</option>
            <option value="for">for loop</option>
        </select>

        <form id="textForm">
            <label for="text">Source:</label>
            <textarea
		    id="sourceText"
		    name="text"
		    rows="20"
		    cols="80"
		    autofocus=true
		    spellcheck=false
		    required
		    >println("hello world");</textarea>
	    <br>

            <button type="submit">Run (Ctrl+Enter)</button>
        </form>

        <div id="responseContainer">
            <h2>Output:</h2>
            <pre id="responseText"></pre>
        </div>

	</div>
    </div>

    <script>

	function submitSampleSelect() {
	    const sb = document.querySelector('#sample');
	    //console.log("submitSampleSelect");
	    //console.log("id = ", sb.selectedIndex);
	    //console.log("vl = ", sb.value);

            // Set the .textContent of this element.  This respects \r\n line breaks, while innerText does not
            elem = document.getElementById('sourceText');
	    switch (sb.value) {
            case "hello":
                console.log("hello");
                elem.textContent = 'println("hello world");';
                break;

            case "for":
                console.log("for");
                elem.textContent =
		    'for i in [0: 10] {\r\n' +
                    '    println("i = ", i);\r\n' +
                    '}\r\n' +
                    '\r\n' +
                    '// Calculate Ï€\r\n' +
                    'let pi = 0.0;\r\n' +
		    'for k in [0: 10] {\r\n' +
                    '    pi = pi + 1 / (16.0 ** k) * (\r\n' +
                    '        4.0 / (8*k + 1) -\r\n' +
                    '        2.0 / (8*k + 4) -\r\n' +
                    '        1.0 / (8*k + 5) -\r\n' +
                    '        1.0 / (8*k + 6)\r\n' +
                    '    );\r\n' +
                    '}\r\n' +
                    'println("pi = ", pi);\r\n' +
                    '';
                break;

            default:
                console.log("default");
                break;
            }
	}

        fetch('/getenv', {
            method: 'POST',
        })
        .then(response => response.text())
        .then(data => {
	    //console.log("data = ", data);
            if (data == "staging") {
                document.getElementById("heading1").innerText = "Syntran explorer staging";
                document.getElementById("title").innerText = "Syntran explorer staging";
	    }
        })
        .catch(error => {
            console.error('Fetch error:', error);
        });

        function submitSourceForm(form) {
            event.preventDefault(); // prevent default behavior

            // Set this to indicate possibly long-running jobs
            document.getElementById('responseText').innerText = "Running ...";

            // Create a FormData object from the form
            const formData = new FormData(form);
    
            //// Debug log
            //for (let [key, value] of formData.entries()) {
            //    console.log(`FormData entry: ${key} = ${value}`);
            //}
    
            // Send FormData using fetch and update the output with response
            // data
            fetch('/submit', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('responseText').innerHTML = data;
            })
            .catch(error => {
                console.error('Fetch error:', error);
            });
        }

	// Listen on whole page for hotkey, regardless of where focus is
        document.addEventListener('keydown', function(event) {
            if(event.key === "Enter" && (event.metaKey || event.ctrlKey)) {
		    submitSourceForm(document.getElementById("textForm"));
	    }
        });

        document.getElementById('textForm').addEventListener('submit', function(event) {
	    submitSourceForm(this);
        });

    </script>
</body>
</html>

